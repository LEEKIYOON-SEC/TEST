name: Argus Phase 1 Test

on:
  workflow_dispatch:
    inputs:
      test_target:
        description: '테스트 대상 (A/B/C/D/E/F 또는 ALL)'
        required: true
        default: 'ALL'
        type: choice
        options:
          - ALL
          - A
          - B
          - C
          - D
          - E
          - F
          - A,B
          - D,E

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          pip install -r requirements.txt

      - name: Run Argus Test
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          NVD_API_KEY: ${{ secrets.NVD_API_KEY }}
          VULNCHECK_API_KEY: ${{ secrets.VULNCHECK_API_KEY }}
        run: |
          cd src
          python test_argus.py --test ${{ github.event.inputs.test_target }}